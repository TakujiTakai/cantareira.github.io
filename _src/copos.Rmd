---
title: "Projeções para água armazenada no sistema Cantareira"
date: "`r format(Sys.time(), '%d de %B de %Y')`"
---

```{r setOptions, include=FALSE, message=FALSE}
library(rmarkdown)
library(zoo)
library(shape)
options(OutDec = ',')
knitr::opts_chunk$set(echo=FALSE, warnings=FALSE, message=FALSE, fig.path='../')
##op <- options(gvis.plot.tag='chart')
```

```{r preparacao, include=FALSE, message=FALSE}
## volume do tronco de cone
Vtc <- function(R, r, h) pi*h*(R^2+r^2+R*r)/3
## Volume, dada altura, raio na base e a razão raio maior/menor do copo (parametro delt da funcao de plotagem)
Vtc2 <- function(h, r, delt){
    b <- (delt*r-r)/2
    R <- r + b*(1+h)
    Vtc(R,r,h)
}
## Encontra numericamente a altura para um dado volume
find.h <- function(V, r, delt, min=0, max=1){
    f1 <- function(h) V - Vtc2(h,r,delt)
    uniroot(f1, c(min, max))$root
}
## Parametros calculados para as figuras
## Volume total na figura
Vtot <- Vtc(0.29,0.29*1.3,1)
## Altura da linha do colume morto
vm <- find.h(Vtot*.2265, .29, 1.3)
## Alturas correspondentes aos niveis de hoje de 30 dias
nivel.hoje <- as.numeric(c1$v.rel2[time(c1)==max(time(c1))])/100
nivel.30 <- tab.pred.30[2,2]/100
alt.h <- find.h(Vtot*nivel.hoje, .29, 1.3)
alt.30 <- find.h(Vtot*nivel.30, 0.29, 1.3)
```

```{r copos, fig.show="hide", fig.height=4.5, fig.width=10}
par(mai=c(0,0,0.2,0))
## Primeiro copo
col3 <- shadepalette("darkblue", "black", n = 50)
emptyplot(xlim = c(0,2), ylim = c(-.5,1.5))
filledcylinder(rx = 0.05, ry = 0.29, angle = 90,
               len=alt.h,
               col = c(col3, rev(col3)), delt=1+(alt.h*.3),
               topcol = col3[25],
               mid = c(0.25, nivel.hoje/2))
filledcylinder(rx = 0.05, ry = 0.3, angle = 90, len=1, col = NULL,
               mid = c(0.25, 0.5), lcol = "darkgrey", lwd=8, delt=1.3)
text(0.25, 1.35, "Hoje", cex=3, family="Arial")
##text(0.25, -0.25, paste(round(nivel.hoje*100,1),"%", sep=""), col="darkgrey", cex=2, family="Arial")
text(-0.5, 0.5, paste(round(nivel.hoje*100,1),"%", sep=""), col="darkgrey", cex=2, family="Arial")
## Segundo copo
filledcylinder(rx = 0.05, ry = 0.29, angle = 90,
               len=alt.30,
               col = c(col3, rev(col3)), delt=1+(alt.30*.3),
               topcol = col3[25],
               mid = c(1.75, nivel.30/2))
filledcylinder(rx = 0.05, ry = 0.3, angle = 90, len=1, col = NULL,
               mid = c(1.75, 0.5), lcol = "darkgrey", lwd=8, delt=1.3)
## Titulos e linhas do volume morto
text(1.75, 1.35, "30 dias", cex=3, family="Arial")
##text(1.75, -0.25, paste(round(nivel.30*100,1),"%", sep=""), col="darkgrey", cex=2, family="Arial")
text(2.5, 0.5, paste(round(nivel.30*100,1),"%", sep=""), col="darkgrey", cex=2, family="Arial")
text(1, vm*1.3, "Volume morto", col="darkgrey", cex=1.1, family="Arial")
segments(0.56,0.226, 1.41, 0.226, lty=3, lwd=3, col="darkgrey")

```
[![Mais detalhes](copos-1.png)](hoje.html)
